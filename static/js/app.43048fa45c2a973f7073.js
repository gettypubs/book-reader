webpackJsonp([1],[,,,function(e,t,i){"use strict";var n=i(2),a=i(35),s=i(23),r=i.n(s);n.a.use(a.a),t.a=new a.a({routes:[{path:"/",name:"Main",component:r.a},{path:"/book/:book/edition/:edition",name:"Manifest",component:r.a},{path:"/book/:book/edition/:edition/image/:image",name:"ImageLink",component:r.a}]})},function(e,t,i){i(19);var n=i(0)(i(7),i(32),null,null);e.exports=n.exports},,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),a=i(4),s=i.n(a),r=i(3);n.a.config.productionTip=!1,new n.a({el:"#app",router:r.a,template:"<App/>",components:{App:s.a}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"app"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"imagelayer",props:{images:{default:[],type:Array},viewport:{default:void 0,type:Object}},data:function(){return{}},updated:function(){},mounted:function(){this.images},watch:{images:function(){this.images}},methods:{handleClick:function(e){console.log("CLICK",e.objId)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(26),a=i.n(n);t.default={name:"main",components:{Reader:a.a},data:function(){return{url:"https://s3.amazonaws.com/pubs-fchasen/books/"+(this.$route.params.book||371)+"/editions/"+(this.$route.params.edition||500)+"/manifest.json"}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(25),a=i.n(n),s=i(1);s.PDFJS.workerSrc="/static/libs/pdfjs-dist/build/pdf.worker.js",t.default={name:"pdf",components:{Page:a.a},props:{src:{type:String},width:{type:Number,default:void 0},height:{type:Number,default:void 0},page:{default:0,type:Number},spreads:{default:!0,type:Boolean}},data:function(){return{pdf:void 0,numPages:0,scale:1,rotate:void 0,isLoading:!0,viewportWidth:0,viewportHeight:0,displayedPage:0,displayedPages:[]}},updated:function(){},mounted:function(){var e=this;this.src&&this.loadDocument(this.src).then(function(){return e.display(e.page)})},watch:{src:function(){var e=this;this.src&&this.loadDocument(this.src).then(function(){return e.display(e.page)})},page:function(e){this.page&&this.display(this.page)}},methods:{loadDocument:function(e){var t=this;return console.log("src",e),s.getDocument(e).then(function(e){var i=e.numPages;t.numPages=i,t.pdf=e,t.isLoading=!1,t.$emit("loaded")})},display:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.page;this.spreads?(this.displayedPages=[],this.displayedPage=e%2==0?e:e-1,this.loadPage(this.displayedPage),this.loadPage(this.displayedPage+1)):(this.displayedPage=e,this.loadPage(this.displayedPage))},next:function(){this.displayedPage+=this.spreads?2:1,this.display(this.displayedPage)},prev:function(){this.displayedPage>1&&(this.displayedPage-=this.spreads?2:1,this.display(this.displayedPage))},loadPage:function(e){var t=this,i=this.pdf;if(!i)throw new Error("Unexpected call to getPage() before the document has been loaded.");var n=e+1;return!e||n<1?n=1:n>=i.numPages&&(n=i.numPages),i.getPage(n).then(function(e){return t.onPageLoad(e)}).catch(function(e){return t.onPageError(e)})},onPageLoad:function(e){this.displayedPages.push(e)},onPageError:function(e){console.error(e)},handleViewport:function(e){this.viewportWidth=e.width,this.viewportHeight=e.height}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(27),a=i.n(n),s=i(22),r=i.n(s);i(1).PDFJS.workerSrc="/static/libs/pdfjs-dist/build/pdf.worker.js",t.default={name:"page",components:{textlayer:a.a,imagelayer:r.a},props:{scale:{default:1,type:Number},rotate:{default:void 0,type:Number},width:{type:Number},height:{type:Number},page:{default:void 0,type:Object},onViewport:{default:void 0,type:Function}},data:function(){return{pdf:void 0,isLoading:!0,viewportWidth:0,viewportHeight:0,viewportScale:1,viewport:void 0,textContent:void 0,images:[]}},updated:function(){},mounted:function(){this.page&&this.displayPage(this.page)},watch:{page:function(){this.page&&this.displayPage(this.page)}},methods:{getPageScale:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.page,t=this.scale,i=this.width,n=1;return i&&(n=i/e.getViewport(t).width),t*n},displayPage:function(e){var t=this.$refs.canvas,i=t.getContext("2d"),n=this.scale,a=this.rotate,s=1!==n?n:this.getPageScale(e),r=e.getViewport(s,a),o=this.images,d=0,p={beginLayout:function(){},endLayout:function(){},appendImage:function(t){t.page=e.pageIndex,t.index=d,o.push(t),d++}};this.viewport=r,this.viewportScale=n,this.viewportHeight=r.height,this.viewportWidth=r.width,this.onViewport&&this.onViewport(r),e.render({canvasContext:i,viewport:r,imageLayer:p})},onPageError:function(e){console.error(e)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(24),a=i.n(n),s=i(38);i.n(s);t.default={name:"reader",components:{PDF:a.a},props:["manifest-url"],data:function(){return{manifest:{},images:[],page:0}},created:function(){this.fetchManifest(),window.addEventListener("keyup",this.keyListener.bind(this),!1)},beforeDestory:function(){window.removeEventListener("keyup",this.keyListener)},methods:{fetchManifest:function(){var e=this;return fetch(this.manifestUrl).then(function(e){return e.json()}).then(function(t){console.log(t),e.manifest=t})},loaded:function(){this.images=this.manifest.images},next:function(){this.$refs.pdf.next()},prev:function(){this.$refs.pdf.prev()},keyListener:function(e){var t=e.keyCode;37===t?this.prev():39===t&&this.next()}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1);t.default={name:"textlayer",props:{page:{default:void 0},viewport:{default:void 0},renderTimeout:{default:300,type:Number}},data:function(){return{}},updated:function(){},mounted:function(){var e=this;this.page&&this.getTextContent(this.page).then(function(t){return e.onContent(t)})},watch:{page:function(){var e=this;this.page&&this.getTextContent(this.page).then(function(t){return e.onContent(t)})}},methods:{getTextContent:function(e){return e.getTextContent({normalizeWhitespace:!0})},onContent:function(e){var t=this.$refs.textLayer;this.textDivs=[];var i=document.createDocumentFragment();this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.textLayerRenderTask=n.renderTextLayer({textContent:e,container:i,viewport:this.viewport,textDivs:this.textDivs,timeout:this.renderTimeout}),this.textLayerRenderTask.promise.then(function(){t.appendChild(i)})},onPageError:function(e){console.error(e)}}}},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){i(20);var n=i(0)(i(8),i(33),"data-v-633d2fa2",null);e.exports=n.exports},function(e,t,i){i(14);var n=i(0)(i(9),i(28),"data-v-0b9bd71c",null);e.exports=n.exports},function(e,t,i){i(21);var n=i(0)(i(10),i(34),"data-v-84dcc46e",null);e.exports=n.exports},function(e,t,i){i(15);var n=i(0)(i(11),i(29),"data-v-2ded1648",null);e.exports=n.exports},function(e,t,i){i(18);var n=i(0)(i(12),i(31),"data-v-59fa2e3c",null);e.exports=n.exports},function(e,t,i){i(17),i(16);var n=i(0)(i(13),i(30),"data-v-448030bb",null);e.exports=n.exports},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("Reader",{attrs:{"manifest-url":e.url}})},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pageWrapper",class:{loading:e.isLoading},style:{width:e.viewportWidth+"px",height:e.viewportHeight+"px"}},[i("canvas",{ref:"canvas",attrs:{width:e.viewportWidth+"px",height:e.viewportHeight+"px"}}),e._v(" "),i("textlayer",{attrs:{page:e.page,viewport:e.viewport}}),e._v(" "),i("imagelayer",{attrs:{images:e.images,viewport:e.viewport}}),e._v(" "),i("div",{ref:"annotationLayer"})],1)},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{ref:"textLayer",staticClass:"textLayer",style:{width:(e.viewport?e.viewport.width:0)+"px",height:(e.viewport?e.viewport.height:0)+"px"}})},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"page-wrap"}},[i("PDF",{ref:"pdf",attrs:{src:this.manifest.pdf,page:e.page,width:1e3},on:{loaded:e.loaded}}),e._v(" "),i("div",{staticClass:"arrow",attrs:{id:"prev"},on:{click:this.prev}},[e._v("‹")]),e._v(" "),i("div",{staticClass:"arrow",attrs:{id:"next"},on:{click:this.next}},[e._v("›")]),e._v(" "),i("header",[i("h1",[e._v(e._s(e.manifest.title)+": ")]),e._v(" "),i("h2",[e._v(e._s(e.manifest.subtitle)+", ")]),e._v(" "),i("h3",[e._v(e._s(e.manifest.author_as_it_appears))])]),e._v(" "),i("div",{attrs:{id:"images"}},[i("ol",e._l(e.images,function(t){return i("li",[i("a",{staticClass:"img_link",on:{click:function(i){e.page=t.page-1}}},[i("img",{attrs:{src:t.thumbnail}})])])}))])],1)},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("router-view")],1)},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"imageLayer",staticClass:"imageLayer",style:{width:(e.viewport?e.viewport.width:0)+"px",height:(e.viewport?e.viewport.height:0)+"px"}},e._l(e.images,function(t){return i("div",{staticClass:"imageLayerItem",style:{width:t.width+"px",height:t.height+"px",top:t.top-t.height+"px",left:t.left+"px"},on:{click:function(i){e.handleClick(t)}}})}))},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"pageContainer",class:{loading:e.isLoading},style:{width:e.width+"px",height:(e.height?e.height:e.viewportHeight)+"px"}},e._l(e.displayedPages,function(t){return i("div",{staticClass:"page"},[i("page",{attrs:{page:t,width:e.spreads?e.width/2:e.width,height:e.height,onViewport:e.handleViewport}})],1)}))},staticRenderFns:[]}}],[6]);
//# sourceMappingURL=app.43048fa45c2a973f7073.js.map